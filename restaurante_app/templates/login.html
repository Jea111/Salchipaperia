<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>

<div class="d-flex align-items-center justify-content-center bg-light">
  <div
    class="card shadow-lg mb-lg-5 mt-lg-5 py-5 g-5 border-0 rounded-4"
    style="max-width: 450px; width: 100%"
  >
    <div class="card-body">
      <h3 class="text-center mb-4 fw-bold text-success">
        <i class="fas fa-shopping-basket me-2"></i> Confirmar Pedido
      </h3>

      <form method="POST" id="form-pedido">
        {% csrf_token %}

        <div class="mb-3">
          <label for="nombre" class="form-label fw-semibold"
            >Nombre completo</label
          >
          <input
            type="text"
            class="form-control form-control-lg"
            id="nombre"
            name="nombre"
            placeholder="Escribe tu nombre"
            required
          />
        </div>

        <div class="mb-3">
          <label for="direccion" class="form-label fw-semibold"
            >Direcci√≥n de entrega</label
          >
          <input
            type="text"
            class="form-control form-control-lg"
            id="direccion"
            name="direccion"
            placeholder="Calle 123 #45-67"
            required
          />
        </div>

        <div class="mb-3">
          <label for="telefono" class="form-label fw-semibold">Tel√©fono</label>
          <input
            type="tel"
            class="form-control form-control-lg"
            id="telefono"
            name="telefono"
            placeholder="300 123 4567"
            pattern="[0-9 ]{10,}"
            title="Ingresa un n√∫mero de tel√©fono v√°lido"
            required
          />
        </div>

        <div class="mb-4">
          <label for="metodo_pago" class="form-label fw-semibold"
            >M√©todo de pago</label
          >
          <select
            class="form-select form-select-lg"
            id="metodo_pago"
            name="metodo_pago"
            required
          >
            <option value="">Seleccione...</option>
            <option value="efectivo">üíµ Efectivo</option>
            <option value="nequi">üì± Nequi</option>
            <option value="bancolombia">üè¶ Bancolombia</option>
          </select>
        </div>

        <input type="hidden" id="carrito" name="carrito" required />

        <div id="resumen-pedido" class="mb-lg-5 p-3 bg-light rounded">
          <h6 class="fw-bold mb-3">Resumen del pedido:</h6>
          <div id="items-carrito"></div>
          <hr />
          <div class="d-flex justify-content-between">
            <strong>Total:</strong>
            <span id="total-pedido"></span>
          </div>
        </div>

        <button type="submit" class="btn btn-success btn-lg w-100 shadow-sm">
          <i class="fas fa-check-circle me-2"></i>Confirmar Pedido
        </button>
      </form>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("form-pedido");
    const carritoData = localStorage.getItem("carrito");

    if (!carritoData || carritoData === "[]") {
      window.location.href = "/";
      return;
    }

    // Asignar el carrito al campo oculto
    document.getElementById("carrito").value = carritoData;

    // Mostrar resumen del pedido
    const carrito = JSON.parse(carritoData);
    const itemsContainer = document.getElementById("items-carrito");
    let total = 0;

    carrito.forEach((item) => {
      const subtotal = item.precio * item.cantidad;
      total += subtotal;

      const itemDiv = document.createElement("div");
      itemDiv.className =
        "d-flex justify-content-between align-items-center mb-2";
      itemDiv.innerHTML = `
            <span>${item.nombre} √ó ${item.cantidad}</span>
            <span>$${subtotal.toFixed(2)}</span>
        `;
      itemsContainer.appendChild(itemDiv);
    });

    document.getElementById("total-pedido").textContent = `$${total.toFixed(
      2
    )}`;

    // Manejar env√≠o del formulario
    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const formData = new FormData(form);
      if (!formData.get("carrito")) {
        alert("Error: No hay productos en el carrito");
        return;
      }

      // Enviar el formulario
      form.submit();

      localStorage.removeItem("carrito");
    });
  });
</script>
